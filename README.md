# üå¶ Weather Project

**Weather Project** ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ (ESP32/ESP8266 –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö), –∫–æ—Ç–æ—Ä–∞—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ –∏ –¥–∞–≤–ª–µ–Ω–∏—è –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö SQLite –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞.

–ü—Ä–æ–µ–∫—Ç —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω —Å –ø—Ä–∏—Ü–µ–ª–æ–º –Ω–∞ **–ø—Ä–æ—Å—Ç–æ—Ç—É**, **–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å** –∏ **–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**. –í—Å—ë —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö –∏ –ª–µ–≥–∫–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–∞–∂–µ –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ.

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ü—Ä–∏—ë–º –¥–∞–Ω–Ω—ã—Ö –æ—Ç ESP-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ (HTTP POST, JSON).
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ SQLite —Å —Ä–µ—Ç–µ–Ω—à–Ω–æ–º (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π).
- Telegram-–±–æ—Ç:
  - —Ç–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è,
  - –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø—Ä–æ—à–ª–æ–º (—á–µ—Ä–µ–∑ `/ago`),
  - —Ç—Ä–µ–Ω–¥—ã (`/trend`),
  - inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–µ–Ω—Å–æ—Ä–∞ –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞,
  - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω—Ç–∏-–¥—Ä–µ–±–µ–∑–≥.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è/–º–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Docker Compose).
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ `.env`.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
flowchart LR
    subgraph ESP[ESP32 / ESP8266 Sensors]
        AHT20/DHT22 -->|t,h| HTTP
        BME280 -->|t,h,p| HTTP
    end

    ESP -->|POST JSON| S1[esp_server]

    subgraph Docker
        S1[esp_server<br/>Python + SQLite]
        S2[telegram_bot<br/>python-telegram-bot]
        S3[init_db<br/>init schema]
    end

    S1 <--> |read/write| DB[(SQLite DB)]
    S2 -->|read| DB

    U[User / Telegram] -->|commands| S2
    S2 -->|responses| U
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
weather-project/
‚îú‚îÄ‚îÄ esp_server/        # HTTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è ESP
‚îÇ   ‚îú‚îÄ‚îÄ esp_server.py
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile.esp
‚îú‚îÄ‚îÄ telegram_bot/      # Telegram-–±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ bot.py
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ init_db/           # –°–µ—Ä–≤–∏—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã
‚îÇ   ‚îú‚îÄ‚îÄ init_db.py
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ data/              # –¢–æ–º —Å –ë–î –∏ –ª–æ–≥–∞–º–∏ (—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ)
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env.example       # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ README.md
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/W1spi/weather-project.git
cd weather-project
```

2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ

–°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª .env –Ω–∞ –æ—Å–Ω–æ–≤–µ .env.example:

```bash
cp .env.example .env
nano .env
```

–ü—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```env
BOT_TOKEN=your_telegram_token
TZ=Europe/Moscow
DATA_DIR=/data
DB_FILE=/data/weather.db
```

3. –ó–∞–ø—É—Å–∫–∞–µ–º

```bash
docker compose up -d --build
```

4. –ü—Ä–æ–≤–µ—Ä—è–µ–º

Telegram-–±–æ—Ç: –ø–∏—à–µ–º /start –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º.

## –ü—Ä–∏–º–µ—Ä API –¥–ª—è ESP

ESP32 —à–ª—ë—Ç POST –∑–∞–ø—Ä–æ—Å—ã –≤ http://<server>:8080/ —Å —Ç–µ–ª–æ–º JSON:

```JSON
{
  "t_dht": 22.5,
  "h_dht": 40,
  "t_bme": 22.3,
  "h_bme": 42,
  "pressure": 755,
  "zone": "indoor",
  "source": "esp32-c3"
}
```

–°–µ—Ä–≤–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–ª–∏–∞—Å—ã –¥–ª—è –ø–æ–ª–µ–π:
–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ```t_dht, temperature_dht, t_bme, temperature, temp```
–í–ª–∞–∂–Ω–æ—Å—Ç—å: ```h_dht, humidity_dht, h_bme, humidity, hum```
–î–∞–≤–ª–µ–Ω–∏–µ: ```pressure, press, p_bme```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Telegram-–±–æ—Ç–∞

–ö–æ–º–∞–Ω–¥—ã

```
/start ‚Äî —Å–ø—Ä–∞–≤–∫–∞ –∏ –º–µ–Ω—é.
/weather ‚Äî —Ç–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è.
/ago <–º–∏–Ω—É—Ç—ã> [sensor] ‚Äî –∑–Ω–∞—á–µ–Ω–∏—è N –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥.
/trend [–º–∏–Ω—É—Ç—ã] [sensor] ‚Äî —Ç—Ä–µ–Ω–¥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 –º–∏–Ω—É—Ç).
/debug ‚Äî –∫—Ä–∞—Ç–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ë–î.
/dbdiag ‚Äî –ø—É—Ç—å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î.
```

Inline-–∫–Ω–æ–ø–∫–∏

–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–Ω—Å–æ—Ä–æ–≤: BME280 / DHT22.
–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞: –°–µ–π—á–∞—Å, 30 –º–∏–Ω, 1 —á–∞—Å, 2 —á–∞—Å–∞.
–¢—Ä–µ–Ω–¥: Œî 30 –º–∏–Ω.

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è             | –û–ø–∏—Å–∞–Ω–∏–µ                             | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é       |
| ---------------------- | ------------------------------------ | ------------------ |
| `BOT_TOKEN`            | Telegram Bot API —Ç–æ–∫–µ–Ω               | ‚Äî                  |
| `DB_FILE`              | –ø—É—Ç—å –∫ SQLite –ë–î                     | `/data/weather.db` |
| `DATA_DIR`             | –∫–∞—Ç–∞–ª–æ–≥ –¥–∞–Ω–Ω—ã—Ö                       | `/data`            |
| `TZ`                   | —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å (IANA)                  | `Europe/Moscow`    |
| `RETENTION_DAYS`       | —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ          | `90`               |
| `LOG_FILE`             | –ø—É—Ç—å –¥–ª—è JSONL-–ª–æ–≥–æ–≤ (–æ–ø—Ü–∏—è)         | –ø—É—Å—Ç–æ              |
| `JSONL_ROTATE_MONTHLY` | —Ä–µ–∑–∞—Ç—å JSONL –ø–æ –º–µ—Å—è—Ü–∞–º (true/false) | `false`            |

## –î–∞–ª—å–Ω–µ–π—à–∏–µ –ø–ª–∞–Ω—ã

–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É Grafana/Prometheus –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.
–†–∞—Å—à–∏—Ä–∏—Ç—å ESP-–ø—Ä–æ—Ç–æ–∫–æ–ª (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ CO‚ÇÇ –∏ –¥—Ä. –¥–∞—Ç—á–∏–∫–æ–≤).
–°–¥–µ–ª–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã —á–µ—Ä–µ–∑ alembic –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º.
CI/CD (GitHub Actions ‚Üí –∞–≤—Ç–æ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤).

## –í–∫–ª–∞–¥

Pull Request‚Äô—ã –∏ Issues –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è!
–ü—Ä–æ–µ–∫—Ç –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è –∫–∞–∫ pet-project –¥–ª—è –¥–æ–º–∞—à–Ω–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω –∏ –¥—Ä—É–≥–∏–º.

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ –∏ –¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–±–æ–¥–Ω–æ.
